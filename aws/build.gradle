task copyApiHandler(type: Copy) {
    dependsOn "api-handler:build"
    from file("api-handler/build/dist/lambda.zip")
    into "module/lambdas"
    rename { "api-handler.zip" }
}

task copyWorker(type: Copy) {
    dependsOn "worker:build"
    from file("worker/build/dist/lambda.zip")
    into "module/lambdas"
    rename { "worker.zip" }
}

task downloadMediaInfo(type: Download) {
    sourceUrl = "https://mediaarea.net/download/binary/mediainfo/24.12/MediaInfo_CLI_24.12_Lambda_x86_64.zip"
    target = file("module/layers/MediaInfo_CLI_24.12_Lambda_x86_64.zip")
}

class Download extends DefaultTask {
    @Input
    String sourceUrl

    @OutputFile
    File target

    @TaskAction
    void download() {
        ant.get(src: sourceUrl, dest: target)
    }
}

task build {
    dependsOn copyApiHandler
    dependsOn copyWorker
    dependsOn downloadMediaInfo
}
